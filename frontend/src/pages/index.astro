---
import { pb } from '../lib/pocketbase';

// LOGIKA TETAP SAMA (SIMPEL)
const posts = await pb.collection('berita_mapala').getFullList({
    sort: '-created',
});

const headline = posts[0]; 
const otherPosts = posts.slice(1);

function getImageUrl(record, filename) {
    if (!filename) return null;
    return `${pb.baseUrl}/api/files/${record.collectionId}/${record.id}/${filename}`;
}
---

<html lang="id" class="scroll-smooth">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>MAPALA - Konservasi & Bencana</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Merriweather:ital,wght@0,300;0,700;1,300&display=swap" rel="stylesheet">
	</head>
	<body class="bg-gray-50 text-gray-800 font-sans antialiased">
		
		<nav class="sticky top-0 z-40 w-full bg-white/80 backdrop-blur-md border-b border-gray-100 transition-all">
			<div class="max-w-6xl mx-auto px-6 h-16 flex justify-between items-center">
				<a href="/" class="flex items-center gap-2 group">
                    <div class="w-8 h-8 bg-green-700 text-white rounded flex items-center justify-center font-bold text-lg">M</div>
					<span class="font-bold tracking-tight text-gray-900 group-hover:text-green-700 transition-colors">MAPALA<span class="text-gray-400 font-normal">NEWS</span></span>
				</a>
				<div class="hidden md:flex space-x-8 text-xs font-bold tracking-widest text-gray-500 uppercase">
					<a href="#" class="hover:text-green-700 transition-colors py-2 border-b-2 border-transparent hover:border-green-700">Konservasi</a>
					<a href="#" class="hover:text-red-700 transition-colors py-2 border-b-2 border-transparent hover:border-red-700">Bencana</a>
					<a href="#" class="hover:text-blue-700 transition-colors py-2 border-b-2 border-transparent hover:border-blue-700">Ekspedisi</a>
				</div>
			</div>
		</nav>

		<main class="max-w-6xl mx-auto px-6 py-8">
			
			{headline && (
				<section class="mb-16">
                    <div class="relative group rounded-2xl overflow-hidden shadow-xl aspect-[16/9] md:aspect-[21/9]">
                        <a href={`/berita/${headline.id}`} class="block w-full h-full">
                            <div class="absolute inset-0 bg-gray-200">
                                {headline.foto_utama ? (
                                    <img 
                                        src={getImageUrl(headline, headline.foto_utama)} 
                                        alt={headline.judul}
                                        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                                    />
                                ) : (
                                    <div class="flex items-center justify-center h-full text-gray-400">No Image</div>
                                )}
                            </div>
                            
                            <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"></div>

                            <div class="absolute bottom-0 left-0 p-6 md:p-10 w-full md:w-2/3">
                                <span class="inline-block px-3 py-1 mb-4 text-[10px] font-bold tracking-widest text-white uppercase bg-green-700 rounded-sm shadow-md">
                                    {headline.kategori}
                                </span>
                                <h1 class="font-serif text-3xl md:text-4xl lg:text-5xl font-bold text-white leading-tight mb-4 drop-shadow-md group-hover:underline decoration-green-500 decoration-4 underline-offset-4">
                                    {headline.judul}
                                </h1>
                                <p class="text-gray-300 text-sm md:text-base line-clamp-2 max-w-xl font-light">
                                    {headline.konten.replace(/<[^>]*>?/gm, '')}
                                </p>
                            </div>
                        </a>
                    </div>
				</section>
			)}

			<div class="border-t border-dashed border-gray-300 pt-10">
				<div class="flex items-center justify-between mb-8">
                    <h3 class="text-xl font-bold text-gray-900 border-l-4 border-green-700 pl-3">Terbaru Hari Ini</h3>
                    <a href="#" class="text-xs font-bold text-gray-500 hover:text-green-700 flex items-center gap-1">LIHAT SEMUA â†’</a>
                </div>
				
				<div class="grid md:grid-cols-3 gap-8">
					{otherPosts.map((post) => (
						<article class="group flex flex-col bg-white rounded-xl overflow-hidden border border-gray-100 hover:shadow-xl hover:-translate-y-1 transition-all duration-300">
							<a href={`/berita/${post.id}`} class="relative aspect-[3/2] overflow-hidden bg-gray-100">
								{post.foto_utama && (
									<img 
										src={getImageUrl(post, post.foto_utama)} 
										alt={post.judul}
										class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
									/>
								)}
                                <div class="absolute top-3 left-3 bg-white/90 backdrop-blur px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider text-gray-800 shadow-sm">
                                    {post.kategori}
                                </div>
							</a>

                            <div class="p-5 flex flex-col flex-1">
                                <div class="text-[11px] text-gray-400 font-medium mb-2 flex items-center gap-2">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                    {new Date(post.created).toLocaleDateString('id-ID', { dateStyle: 'long' })}
                                </div>
								
								<h2 class="font-serif text-lg font-bold leading-snug text-gray-900 mb-3 group-hover:text-green-700 transition-colors">
									<a href={`/berita/${post.id}`}>
										{post.judul}
									</a>
								</h2>
								
								<p class="text-sm text-gray-500 leading-relaxed line-clamp-3 mb-4 flex-1">
									{post.konten.replace(/<[^>]*>?/gm, '')}
								</p>

                                <a href={`/berita/${post.id}`} class="inline-flex items-center text-xs font-bold text-green-700 uppercase tracking-wide mt-auto group-hover:underline">
                                    Baca Selengkapnya
                                </a>
							</div>
						</article>
					))}
				</div>
			</div>
		</main>

		<footer class="bg-white border-t border-gray-200 mt-20 py-10 text-center">
			<p class="text-xs font-bold tracking-widest text-gray-400 uppercase">&copy; 2026 Mapala Indonesia</p>
		</footer>

        <style>
            .font-serif { font-family: 'Merriweather', serif; }
            .font-sans { font-family: 'Inter', sans-serif; }
        </style>
	</body>
</html>