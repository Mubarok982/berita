---
import { pb } from '../../lib/pocketbase';

// 1. Fungsi Wajib untuk Astro (Mode Statis):
// Ini memberitahu Astro daftar ID berita apa saja yang ada di database
// supaya dia bisa bikinin halamannya satu-satu.
export async function getStaticPaths() {
    const posts = await pb.collection('berita_mapala').getFullList();
    
    return posts.map((post) => ({
        params: { id: post.id },
        props: { post },
    }));
}

// 2. Ambil data berita yang dikirim dari fungsi di atas
const { post } = Astro.props;

// Helper URL Gambar (Sama kayak di index)
function getImageUrl(record, filename) {
    if (!filename) return null;
    return `${pb.baseUrl}/api/files/${record.collectionId}/${record.id}/${filename}`;
}
---

<html lang="id">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>{post.judul} - MAPALA</title>
	</head>
	<body class="bg-stone-50 text-stone-900 font-serif min-h-screen pb-20">
		
		<nav class="sticky top-0 bg-white/90 backdrop-blur-sm border-b border-stone-200 px-4 py-4 z-20">
			<div class="max-w-2xl mx-auto flex items-center text-xs font-sans font-bold tracking-widest text-stone-500 hover:text-green-800 transition-colors">
				<a href="/" class="flex items-center gap-2">
					← KEMBALI KE BERANDA
				</a>
			</div>
		</nav>

		<article class="max-w-2xl mx-auto px-4 mt-10">
			
			<header class="mb-10 text-center">
				<div class="flex justify-center gap-4 text-xs font-sans tracking-widest text-stone-400 mb-4">
					<span class="uppercase font-bold text-green-800">{post.kategori}</span>
					<span>•</span>
					<span>{new Date(post.created).toLocaleDateString('id-ID', { dateStyle: 'long' })}</span>
				</div>
				<h1 class="text-3xl md:text-4xl font-black leading-tight mb-6">
					{post.judul}
				</h1>
			</header>

			{post.foto_utama && (
				<figure class="mb-10 -mx-4 md:mx-0">
					<img 
						src={getImageUrl(post, post.foto_utama)} 
						alt={post.judul}
						class="w-full h-auto md:rounded-sm shadow-sm"
					/>
					<figcaption class="text-center text-[10px] font-sans text-stone-400 mt-2 italic">
						Dokumentasi Lapangan
					</figcaption>
				</figure>
			)}

			<div class="prose prose-stone prose-lg max-w-none first-letter:text-5xl first-letter:font-bold first-letter:mr-1 first-letter:float-left first-letter:leading-[0.8]">
				<div set:html={post.konten} />
			</div>

		</article>

	</body>
</html>