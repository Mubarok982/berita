---
import { pb } from '../../lib/pocketbase';
import Navbar from '../../components/Navbar.astro';
import '../../styles/global.css';

export async function getStaticPaths() {
    const posts = await pb.collection('berita_mapala').getFullList();
    return posts.map((post) => ({
        params: { id: post.id },
        props: { post },
    }));
}

const { post } = Astro.props;

// Helper URL Gambar (Bisa dipakai buat foto utama maupun galeri)
function getImageUrl(record, filename) {
    if (!filename) return null;
    return `${pb.baseUrl}/api/files/${record.collectionId}/${record.id}/${filename}`;
}

const bgImage = getImageUrl(post, post.foto_utama);

// Ambil array foto galeri (kalau kosong, dikasih array kosong biar gak error)
const galeriFoto = post.galeri || []; 
---

<html lang="id">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>{post.judul} - MAPALA</title>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&display=swap" rel="stylesheet">
	</head>
	<body class="bg-white text-gray-900 font-serif antialiased">
		
		<Navbar />

        <article>
            <header class="relative w-full h-[60vh] md:h-[70vh] flex items-end justify-center overflow-hidden bg-gray-900">
                {bgImage ? (
                    <img 
                        src={bgImage} 
                        alt={post.judul}
                        class="absolute inset-0 w-full h-full object-cover opacity-80"
                    />
                ) : (
                    <div class="absolute inset-0 bg-gray-800 flex items-center justify-center text-gray-600">No Image</div>
                )}
                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent"></div>

                <div class="relative z-10 max-w-4xl mx-auto px-6 pb-12 text-center">
                    <div class="flex items-center justify-center gap-3 mb-4 text-xs md:text-sm font-sans font-bold tracking-[0.2em] text-white/80 uppercase">
                        <span class="bg-green-700 px-3 py-1 rounded text-white">{post.kategori}</span>
                        <span>‚Ä¢</span>
                        <span>{new Date(post.created).toLocaleDateString('id-ID', { dateStyle: 'long' })}</span>
                    </div>
                    <h1 class="text-3xl md:text-5xl lg:text-6xl font-bold text-white leading-tight drop-shadow-lg">
                        {post.judul}
                    </h1>
                </div>
            </header>

            <div class="max-w-3xl mx-auto px-6 py-16">
                <div class="prose prose-lg prose-stone md:prose-xl prose-img:rounded-xl prose-headings:font-bold prose-a:text-green-700 hover:prose-a:text-green-800 first-letter:text-5xl first-letter:font-bold first-letter:float-left first-letter:mr-3 first-letter:mt-[-4px]">
                    <div set:html={post.konten} />
                </div>

                {galeriFoto.length > 0 && (
                    <div class="mt-16 pt-10 border-t border-dashed border-gray-300">
                        <h3 class="font-sans text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                            üì∏ Dokumentasi Kegiatan
                        </h3>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            {galeriFoto.map((foto) => (
                                <div class="relative group aspect-square overflow-hidden rounded-xl bg-gray-100 cursor-pointer">
                                    <img 
                                        src={getImageUrl(post, foto)} 
                                        alt="Dokumentasi"
                                        loading="lazy"
                                        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                                    />
                                    <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors duration-300"></div>
                                </div>
                            ))}
                        </div>
                    </div>
                )}
                <div class="mt-10 pt-10 border-t border-gray-200">
                    <a href="/" class="inline-flex items-center gap-2 text-sm font-bold tracking-widest text-gray-500 hover:text-green-700 transition-colors uppercase">
                        ‚Üê Kembali ke Beranda
                    </a>
                </div>
            </div>
        </article>

        <footer class="bg-gray-50 border-t border-gray-200 py-12 mt-12 text-center">
			<p class="text-xs font-bold tracking-widest text-gray-400 uppercase">&copy; 2026 Mapala Indonesia</p>
		</footer>

        <style>
            .font-serif { font-family: 'Merriweather', serif; }
            .font-sans { font-family: 'Inter', sans-serif; }
        </style>
	</body>
</html>